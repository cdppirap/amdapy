
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>amdapy.amda &#8212; amdapy 1 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">amdapy 1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for amdapy.amda</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:author: Alexandre Schulz</span>
<span class="sd">:email: alexandre.schulz@irap.omp.eu</span>
<span class="sd">:brief: AMDA dataset provider</span>

<span class="sd">:class:`amdapy.amda.AMDA` is the object through witch we can query the AMDA database for </span>
<span class="sd">available missions, instruments and datasets. Datasets are stored following a predefined</span>
<span class="sd">hierarchy::</span>

<span class="sd">    AMDA collection </span>
<span class="sd">        Mission A</span>
<span class="sd">            Instrument X</span>
<span class="sd">                Dataset 1</span>
<span class="sd">                ...</span>
<span class="sd">                Dataset N</span>
<span class="sd">            ...</span>
<span class="sd">        ...</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">amdapy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">amdapy.amdaWSClient.client</span> <span class="kn">import</span> <span class="n">get_obs_tree</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Container class for storing parameter objects.</span>

<span class="sd">  :param id: identifier of the parameter, should be unique </span>
<span class="sd">  :type id: str</span>
<span class="sd">  :param name: name of the parameter as seen in the AMDA navigation tree</span>
<span class="sd">  :type name: str</span>
<span class="sd">  :param units: units in which are expressed the parameters values</span>
<span class="sd">  :type units: str</span>
<span class="sd">  :param data: values of the parameter</span>
<span class="sd">  :type data: pandas.DataFrame</span>

<span class="sd">  This class is a container for parameter data including identification, name, units and data. We </span>
<span class="sd">  retrieve :class:`amdapy.amda.Parameter` instances by passing a :class:`amdapy.amda.Collection.Parameter`</span>
<span class="sd">  object to the :meth:`amdapy.amda.AMDA.get` or :meth:`amdapy.amda.AMDA.get_dataset` method.</span>

<span class="sd">  .. code-block:: python</span>

<span class="sd">     &gt;&gt;&gt; parameter</span>
<span class="sd">     Parameter (id:ura_sw_n, name:density, units:cm⁻³, shape: (24, 1))</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">units</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
<div class="viewcode-block" id="Parameter.plot"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Parameter.plot">[docs]</a>  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the parameter. Naive plotting function for visualizing time series data.</span>

<span class="sd">    :return: pyplot figure object</span>
<span class="sd">    :rtype: pyplot figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dataset_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;param: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;dataset: </span><span class="si">{}</span><span class="s2">, param: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="c1"># check if parameter has multiple components</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>  
    <span class="k">else</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">[:])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> </div>
  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get parameter data</span>
<span class="sd">    </span>
<span class="sd">    :param key: key, this argument is passed directly to the :data:`data.__getitem__` methode.</span>
<span class="sd">    :type key: slice</span>
<span class="sd">    :return: desired parameter data</span>
<span class="sd">    :rtype: pandas.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
  <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;String representation of the current parameter object</span>

<span class="sd">    :return: string representation of the current object</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="s2">&quot;Parameter (id:</span><span class="si">{}</span><span class="s2">, name:</span><span class="si">{}</span><span class="s2">, units:</span><span class="si">{}</span><span class="s2">, nodata)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Parameter (id:</span><span class="si">{}</span><span class="s2">, name:</span><span class="si">{}</span><span class="s2">, units:</span><span class="si">{}</span><span class="s2">, shape: </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>
<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;AMDA dataset container. Retrieving data from AMDA can be time consuming, as such</span>
<span class="sd">  the object constructor can be called without setting the data. </span>

<span class="sd">  :param el: dataset unique identificator</span>
<span class="sd">  :type el: amdapy.amdaWSClient.client.DatasetElement</span>
<span class="sd">  :param data: optional (default: None), dataset content </span>
<span class="sd">  :type data: array type</span>
<span class="sd">  </span>
<span class="sd">  Get list of parameter ids : </span>

<span class="sd">  .. code-block:: python </span>

<span class="sd">     &gt;&gt;&gt; [p.id for p in dataset.iter_parameter()]</span>
<span class="sd">     [&#39;ura_sw_n&#39;, &#39;ura_sw_v&#39;, &#39;ura_sw_t&#39;, &#39;ura_sw_pdyn&#39;, &#39;ura_sw_b&#39;, &#39;ura_sw_bx&#39;, &#39;ura_sw_da&#39;]</span>

<span class="sd">  You can then get the contents of the parameters by using the bracket operator : </span>

<span class="sd">  .. code-block:: python</span>

<span class="sd">     &gt;&gt;&gt; dataset[&quot;ura_sw_n&quot;]</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">el</span><span class="o">.</span><span class="n">id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">el</span><span class="o">=</span><span class="n">el</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">globalstart</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">globalstop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_parameter_list</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
<div class="viewcode-block" id="Dataset.make_parameter_list"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Dataset.make_parameter_list">[docs]</a>  <span class="k">def</span> <span class="nf">make_parameter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
      <span class="n">param</span><span class="o">=</span><span class="n">Parameter</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">param</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># get the names of the columns</span>
        <span class="n">cc</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
          <span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">param</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Dataset.iter_parameter"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Dataset.iter_parameter">[docs]</a>  <span class="k">def</span> <span class="nf">iter_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parameter iterator</span>

<span class="sd">    :return: parameter object</span>
<span class="sd">    :rtype: amdapy.amda.Parameter</span>

<span class="sd">    Parameter iterator. For example get a list of parameter name and units :</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; [p.name for p in dataset.iter_parameter()]</span>
<span class="sd">       [&#39;density&#39;, &#39;velocity&#39;, &#39;temperature&#39;, &#39;dynamic pressure&#39;, &#39;b tangential&#39;, &#39;b radial&#39;, &#39;angle Uranus-Sun-Earth&#39;]</span>
<span class="sd">       &gt;&gt;&gt; [p.units for p in dataset.iter_parameter()]</span>
<span class="sd">       [&#39;cm⁻³&#39;, &#39;km/s&#39;, &#39;eV&#39;, &#39;nPa&#39;, &#39;nT&#39;, &#39;nT&#39;, &#39;deg&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
      <span class="k">yield</span> <span class="n">p</span></div>
  <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_params</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dataset string representation</span>

<span class="sd">    :param show_params: optional (default: True), print parameters also</span>
<span class="sd">    :type show_params: bool</span>
<span class="sd">    :return: dataset string representation</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="o">=</span><span class="s2">&quot;Dataset (id:</span><span class="si">{}</span><span class="s2">, start:</span><span class="si">{}</span><span class="s2">, stop:</span><span class="si">{}</span><span class="s2">, n_param:</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalstop</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">el</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
      <span class="n">a</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>
<div class="viewcode-block" id="Dataset.time"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Dataset.time">[docs]</a>  <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get time value for this dataset</span>

<span class="sd">    :return: time </span>
<span class="sd">    :rtype: pandas.DataFrame </span>

<span class="sd">    Get the datasets time values.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; T = dataset.time()</span>
<span class="sd">       &gt;&gt;&gt; type(T)</span>
<span class="sd">       &lt;class &#39;pandas.core.indexes.datetimes.DatetimeIndex&#39;&gt;</span>
<span class="sd">       &gt;&gt;&gt; T</span>
<span class="sd">       DatetimeIndex([&#39;2010-01-01 01:00:00&#39;, &#39;2010-01-01 02:00:00&#39;,</span>
<span class="sd">                      &#39;2010-01-01 03:00:00&#39;, &#39;2010-01-01 04:00:00&#39;,</span>
<span class="sd">       ...</span>
<span class="sd">                      &#39;2010-01-01 23:00:00&#39;, &#39;2010-01-02 00:00:00&#39;],</span>
<span class="sd">                     dtype=&#39;datetime64[ns]&#39;, name=&#39;Time&#39;, freq=None)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span></div>
  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Item getter</span>

<span class="sd">    :param: item key, either parameter id or name</span>
<span class="sd">    :type key: check numpy documentation</span>
<span class="sd">    :return: desired items</span>
<span class="sd">    :rtype: check numpy documentation for an answer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="c1"># check parameter names and ids      </span>
      <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">key</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="n">key</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">v</span>
      <span class="c1"># check if it corresponds to a column</span>
      <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>
<div class="viewcode-block" id="AMDA"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.AMDA">[docs]</a><span class="k">class</span> <span class="nc">AMDA</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;AMDA database connector. Use this object to connect to query AMDAs database. The :data:`collection`</span>
<span class="sd">  (:class:`Collection`) allows acces to dataset description. </span>

<span class="sd">  .. code-block:: python</span>

<span class="sd">     &gt;&gt;&gt; amda = amdapy.amda.AMDA()</span>
<span class="sd">     &gt;&gt;&gt; for dataset in amda.collection.iter_dataset():</span>
<span class="sd">     &gt;&gt;&gt;     print(dataset)</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;AMDA&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">=</span><span class="n">Collection</span><span class="p">()</span>
  <span class="k">def</span> <span class="nf">_datasetel_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasetel</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a :class:`amdapy.amdaWSClient.obstree.DatasetElement` object to a :class:`amdapy.amda.AMDADataset` object</span>

<span class="sd">    :param datasetel: dataset representation</span>
<span class="sd">    :type datasetel: amdapy.amdaWSClient.obstree.DatasetElement</span>
<span class="sd">    :param start: data start time</span>
<span class="sd">    :type start: datetime.datetime</span>
<span class="sd">    :param stop: data stop time</span>
<span class="sd">    :type stop: datetime.datetime</span>
<span class="sd">    :return: dataset representation</span>
<span class="sd">    :rtype: amdapy.amda.AMDADataset</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the data</span>
    <span class="n">cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_column_names</span><span class="p">(</span><span class="n">datasetel</span><span class="p">)</span>
    <span class="n">did</span><span class="o">=</span><span class="n">datasetel</span><span class="o">.</span><span class="n">id</span>
    <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span><span class="o">=</span><span class="n">datasetel</span><span class="o">.</span><span class="n">globalstart</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">start</span><span class="o">=</span><span class="n">stop</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">pass</span>
    <span class="n">data</span><span class="o">=</span><span class="n">amdapy</span><span class="o">.</span><span class="n">amdaWSClient</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">did</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">])</span>
    <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">datasetel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">_get_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datasetel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get list of column names</span>

<span class="sd">    :param datasetel: dataset collection item</span>
<span class="sd">    :type datasetel: amdapy.amda.Collection</span>
<span class="sd">    :return: list of the column names</span>
<span class="sd">    :rtype: list of str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the dataset contains Time as first column</span>
    <span class="n">col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
    <span class="c1"># check each parameter</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">datasetel</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">n</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
          <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span>
<div class="viewcode-block" id="AMDA.get"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.AMDA.get">[docs]</a>  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets a item from the collection.</span>

<span class="sd">    :param item: collection item</span>
<span class="sd">    :type item: amdapy.amda._CollectionItem</span>
<span class="sd">    :param start: data start time</span>
<span class="sd">    :type start: datetime.datetime or str</span>
<span class="sd">    :param stop: data stop time </span>
<span class="sd">    :type stop: datetime.datetime or str</span>
<span class="sd">    :return: parameter or dataset depending on the input, None if item is badly defined</span>
<span class="sd">    :rtype: amda.Parameter or amda.Dataset</span>
<span class="sd">    </span>
<span class="sd">    The behaviour of this method depends on the type of the :data:`item` argument : </span>
<span class="sd">      * :class:`amdapy.amda.Collection.Dataset` then call the :meth:`amdapy.amda.AMDA.get_dataset`</span>
<span class="sd">      * :class:`amdapy.amda.Collection.Parameter` then call the :meth:`amdapy.amda.AMDA.get_parameter`</span>

<span class="sd">    For example retriving the *tao-ura-sw* dataset is done like this : </span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      &gt;&gt;&gt; dataset_desc = amda.find(&quot;tao-ura-sw&quot;)</span>
<span class="sd">      &gt;&gt;&gt; data = amda.get(dataset_desc)</span>
<span class="sd">      &gt;&gt;&gt; data</span>
<span class="sd">      Dataset (id:tao-ura-sw, start:2010-01-01 00:00:00, stop:2021-02-19 00:00:00, n_param:7)</span>
<span class="sd">          Parameter (id:ura_sw_n, name:density, units:cm⁻³, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_v, name:velocity, units:km/s, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_t, name:temperature, units:eV, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_pdyn, name:dynamic pressure, units:nPa, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_b, name:b tangential, units:nT, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_bx, name:b radial, units:nT, value: None)</span>
<span class="sd">          Parameter (id:ura_sw_da, name:angle Uranus-Sun-Earth, units:deg, value: None)</span>
<span class="sd">    </span>
<span class="sd">    The :data:`start` and :data:`stop` attributes indicate the desired begining and end of the </span>
<span class="sd">    data. If they are :class:`str` objects then they must follow the following scheme ::</span>
<span class="sd">      </span>
<span class="sd">      YYYY-MM-DDThh:mm:ss</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check that the dates provided are datetime objects, if not then convert them</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">start</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">amdapy</span><span class="o">.</span><span class="n">amdaWSClient</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DATE_FORMAT</span><span class="p">)</span> 
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop</span> <span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">stop</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">amdapy</span><span class="o">.</span><span class="n">amdaWSClient</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DATE_FORMAT</span><span class="p">)</span>
    <span class="c1"># check is item is a string, if it is then search for a dataset or parameter</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">desc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Collection</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Collection</span><span class="o">.</span><span class="n">Parameter</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error : argument item is not a Collection.Dataset or Collection.Parameter object&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">None</span></div>
<div class="viewcode-block" id="AMDA.get_parameter"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.AMDA.get_parameter">[docs]</a>  <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get parameter data.</span>

<span class="sd">    :param param: parameter descriptor</span>
<span class="sd">    :type param: amda.Collection.Parameter </span>
<span class="sd">    :param start: data start time</span>
<span class="sd">    :type start: datetime.datetime</span>
<span class="sd">    :param stop: data stop time</span>
<span class="sd">    :type stop: datetime.datetime</span>
<span class="sd">    :return: Parameter object</span>
<span class="sd">    :rtype: amdapy.amda.Parameter</span>

<span class="sd">    Given a valid :class:`amdapy.amda.Collection.Parameter` instance you can retrieve the parameters </span>
<span class="sd">    data by calling the :meth:`amdapy.amda.AMDA.get_parameter` method on the desired time interval.</span>

<span class="sd">    If the time interval provided is not valid then only the first day of data will be returned. Data</span>
<span class="sd">    is stored as a :class:`pandas.DataFrame` object indexed by time (since all AMDA parameters are</span>
<span class="sd">    timeseries), and you can access it through the :data:`data` attribute.</span>

<span class="sd">    Continuing with the example dataset :data:`tao-ura-sw` you can retrive the *density* parameter (id : ura_sw_n) like this : </span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        &gt;&gt;&gt; parameter_desc = amda.collection.find(&quot;ura_sw_n&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parameter_desc</span>
<span class="sd">        Parameter item (id:ura_sw_n, name:density, units:cm⁻³, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">        &gt;&gt;&gt; parameter = amda.get_parameter(parameter_desc)</span>
<span class="sd">        &gt;&gt;&gt; parameter</span>
<span class="sd">        Parameter (id:ura_sw_n, name:density, units:cm⁻³, shape: (24, 1))</span>
<span class="sd">        &gt;&gt;&gt; parameter_desc[:]</span>
<span class="sd">                             density</span>
<span class="sd">        Time                        </span>
<span class="sd">        2010-01-01 01:00:00    0.005</span>
<span class="sd">        2010-01-01 02:00:00    0.006</span>
<span class="sd">        ...</span>
<span class="sd">        2010-01-01 23:00:00    0.008</span>
<span class="sd">        2010-01-02 00:00:00    0.008</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">psize</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">n</span>
    <span class="n">col_names</span><span class="o">=</span><span class="kc">None</span>
    <span class="c1"># check the display type</span>
    <span class="k">if</span> <span class="n">psize</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
      <span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
    <span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">col_names</span>
    <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># get the parent dataset start and stop times</span>
        <span class="n">parent_desc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="n">start</span><span class="o">=</span><span class="n">parent_desc</span><span class="o">.</span><span class="n">globalstart</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">start</span><span class="o">=</span><span class="n">stop</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">pass</span>
    <span class="n">d</span><span class="o">=</span><span class="n">amdapy</span><span class="o">.</span><span class="n">amdaWSClient</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span> <span class="n">col_names</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Parameter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>
<div class="viewcode-block" id="AMDA.get_dataset"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.AMDA.get_dataset">[docs]</a>  <span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_item</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get dataset contents.</span>

<span class="sd">    :param dataset_item: dataset item</span>
<span class="sd">    :type dataset_id: Collection.Dataset</span>
<span class="sd">    :param start: data start time</span>
<span class="sd">    :type start: datetime.datetime</span>
<span class="sd">    :param stop: data stop time</span>
<span class="sd">    :type stop: datetime.datetime</span>
<span class="sd">    :return: dataset object if found, None otherwise</span>
<span class="sd">    :rtype: amdapy.amda.Dataset or None</span>

<span class="sd">    Retrieves the dataset contents between :data:`t_interval.start` to :data:`t_interval.stop`. If the</span>
<span class="sd">    :data:`t_interval` is not a valid interval then only the first day of data will be retrieved. This</span>
<span class="sd">    behaviour was chosen to avoid too many requests for downloading the whole dataset (which can be</span>
<span class="sd">    extensive).</span>

<span class="sd">    In the following example we download the first day of the :data:`tao-ura-sw`.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; amda = AMDA()</span>
<span class="sd">       &gt;&gt;&gt; dataset_desc = amda.collection.find(&quot;tao-ura-sw&quot;)</span>
<span class="sd">       &gt;&gt;&gt; dataset = amda.get_dataset(dataset_desc)</span>
<span class="sd">       &gt;&gt;&gt; dataset</span>
<span class="sd">       Dataset (id:tao-ura-sw, start:2010-01-01 00:00:00, stop:2021-02-19 00:00:00, n_param:7)</span>
<span class="sd">           Parameter (id:ura_sw_n, name:density, units:cm⁻³, shape: (24,))</span>
<span class="sd">           Parameter (id:ura_sw_v, name:velocity, units:km/s, nodata)</span>
<span class="sd">           Parameter (id:ura_sw_t, name:temperature, units:eV, shape: (24,))</span>
<span class="sd">           Parameter (id:ura_sw_pdyn, name:dynamic pressure, units:nPa, shape: (24,))</span>
<span class="sd">           Parameter (id:ura_sw_b, name:b tangential, units:nT, shape: (24,))</span>
<span class="sd">           Parameter (id:ura_sw_bx, name:b radial, units:nT, shape: (24,))</span>
<span class="sd">           Parameter (id:ura_sw_da, name:angle Uranus-Sun-Earth, units:deg, shape: (24,))</span>

<span class="sd">    The actual data is stored as a :class:`pandas.DataFrame` object. You can access the data</span>
<span class="sd">    through the bracket operator. When passing a :class:`slice` object to :meth:`amdapy.amda.AMDA.get_dataset` the bracket operator is called on the :data:`data` attribute.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; dataset[:]</span>
<span class="sd">                                  density  velocity_V r  ...  b radial  angle Uranus-Sun-Earth</span>
<span class="sd">       Time                                            ...                                  </span>
<span class="sd">       2010-01-01T01:00:00.000    0.005       347.811  ...    -0.002                   2.305</span>
<span class="sd">       2010-01-01T02:00:00.000    0.006       347.616  ...    -0.002                   2.518</span>
<span class="sd">       2010-01-01T03:00:00.000    0.006       347.407  ...    -0.002                   2.731</span>
<span class="sd">       2010-01-01T04:00:00.000    0.007       347.185  ...    -0.002                   2.938</span>
<span class="sd">       2010-01-01T05:00:00.000    0.008       346.966  ...    -0.002                   3.148</span>
<span class="sd">       2010-01-01T06:00:00.000    0.008       346.709  ...    -0.002                   3.360</span>
<span class="sd">       2010-01-01T07:00:00.000    0.008       346.539  ...    -0.002                   3.571</span>

<span class="sd">    The previous call is equivalent to :</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; dataset.data[:]</span>

<span class="sd">    Passing a parameter name or id to :meth:`amdapy.amda.AMDA.get_dataset` will return the corresponding</span>
<span class="sd">    :class:`amdapy.amda.Parameter` object. Individual parameters are retrieved by : </span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; dataset[&quot;density&quot;]</span>
<span class="sd">       Parameter (id:ura_sw_n, name:density, units:cm⁻³, shape: (24,))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datasetel_to_dataset</span><span class="p">(</span><span class="n">dataset_item</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span></div></div>

<span class="k">class</span> <span class="nc">_CollectionItem</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Collection item base class. This is a base class shared by all items of the collection. All</span>
<span class="sd">  collection items have an id attribute.</span>

<span class="sd">  :param id: unique identification for the current item</span>
<span class="sd">  :type id: str</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>

<div class="viewcode-block" id="Collection"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Collection">[docs]</a><span class="k">class</span> <span class="nc">Collection</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;The :class:`Collection` object is used for getting descriptions of the items in AMDAs database.</span>
<span class="sd">  Navigation the database is done with the :meth:`Collection.iter_dataset` iterator.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the AMDA observatory tree structure</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">=</span><span class="n">get_obs_tree</span><span class="p">()</span>
<div class="viewcode-block" id="Collection.find"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Collection.find">[docs]</a>  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find and collection item by id. </span>

<span class="sd">    :param id: id of the desired item</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :return: Collection item with the right id if found, None otherwise</span>
<span class="sd">    :rtype: amdapy.amda._CollectionItem or None</span>

<span class="sd">    Iterates over all dataset objects in search for one with </span>
<span class="sd">    the right id, if the id doesn&#39;t match then proceeds to check all parameters in the dataset</span>
<span class="sd">    before moving on to the next.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; amda = amdapy.amda.AMDA()</span>
<span class="sd">       &gt;&gt;&gt; var = amda.find(&quot;ura_sw_da&quot;)</span>
<span class="sd">       &gt;&gt;&gt; var</span>
<span class="sd">       Parameter item (id:ura_sw_da, name:angle Uranus-Sun-Earth, units:deg, disp:None, dataset:tao-ura-sw, n:1)</span>

<span class="sd">    If we want a description of the dataset this parameter belongs to then we can do :</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; amda.collection.find(var.dataset_id)</span>
<span class="sd">       Dataset item (id:tao-ura-sw, name:SW / Input OMNI, start:2010-01-01 00:00:00, stop:2021-02-19 00:00:00, n_param:7)h</span>
<span class="sd">           Parameter item (id:ura_sw_n, name:density, units:cm⁻³, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">           Parameter item (id:ura_sw_v, name:velocity, units:km/s, disp:None, dataset:tao-ura-sw, n:2)</span>
<span class="sd">           Parameter item (id:ura_sw_t, name:temperature, units:eV, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">           Parameter item (id:ura_sw_pdyn, name:dynamic pressure, units:nPa, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">           Parameter item (id:ura_sw_b, name:b tangential, units:nT, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">           Parameter item (id:ura_sw_bx, name:b radial, units:nT, disp:None, dataset:tao-ura-sw, n:1)</span>
<span class="sd">           Parameter item (id:ura_sw_da, name:angle Uranus-Sun-Earth, units:deg, disp:None, dataset:tao-ura-sw, n:1)</span>

<span class="sd">    The object returned by :meth:`amdapy.amda.Collection.find` can be passed to the :meth:`amdapy.amda.AMDA.get` method to</span>
<span class="sd">    retrive the contents of the parameter or dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check datasets</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_dataset</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="nb">id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span></div>
<div class="viewcode-block" id="Collection.iter_dataset"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Collection.iter_dataset">[docs]</a>  <span class="k">def</span> <span class="nf">iter_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Collection item iterator</span>
<span class="sd">    </span>
<span class="sd">    :return: collection items</span>
<span class="sd">    :rtype: amdapy.amda.Collection.Item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">iter_dataset</span><span class="p">():</span>
      <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">displaytype</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">displaytype</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">parent_dataset_id</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_component_description</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">parameters</span><span class="p">]</span>
      <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">globalstart</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">datastart</span><span class="p">,</span> <span class="n">globalstop</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">datastop</span><span class="p">)</span></div>
  <span class="k">def</span> <span class="nf">_get_component_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get collection items for the parameters components</span>

<span class="sd">    :param param: parameter object</span>
<span class="sd">    :type param: amdapy.amdaWSClient.obstree.ParameterElement</span>
<span class="sd">    :return: parameter component collection items</span>
<span class="sd">    :rtype: list of amdapy.amda.Collection._Component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_Component</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> 
  <span class="k">class</span> <span class="nc">_Mission</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Object for containing mission description</span>
<span class="sd">    </span>
<span class="sd">    :param id: mission id, unique withing the AMDA context, used to retrieve complete mission description</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :param name: name of the mission</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param description: optional, (default: None) description of the mission</span>
<span class="sd">    :type description: str</span>
<span class="sd">    :param startdate: mission start date</span>
<span class="sd">    :type startdate: datetime.datetime</span>
<span class="sd">    :param stopdate: mission stopdate, None if mission is not terminated</span>
<span class="sd">    :type stopdate: datetime.datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">descrition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startdate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopdate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="n">description</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">startdate</span><span class="o">=</span><span class="n">startdate</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">stopdate</span><span class="o">=</span><span class="n">stopdate</span>
  <span class="k">class</span> <span class="nc">_Instrument</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Object for containing instrument description</span>

<span class="sd">    :param id: instrument identifier</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :param name: name of the instrument</span>
<span class="sd">    :type name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
  <span class="k">class</span> <span class="nc">_Component</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parameter component description</span>

<span class="sd">    :param id: component id</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :param name: component name</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param index: component column index</span>
<span class="sd">    :typa index: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">index</span>
<div class="viewcode-block" id="Collection.Parameter"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Collection.Parameter">[docs]</a>  <span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="n">_CollectionItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This object contains parameter descriptions.</span>

<span class="sd">    .. warning::</span>

<span class="sd">      Parameter descriptions do not contain any information about the data timespan, to get the</span>
<span class="sd">      begining and end date of the data you must retrieve the parent dataset whose id is given by the</span>
<span class="sd">      :data:`dataset_id` attribute.</span>

<span class="sd">    You can access the following information through this container : </span>
<span class="sd">       * id : unique parameter id</span>
<span class="sd">       * name : parameter name</span>
<span class="sd">       * units : data units</span>
<span class="sd">       * dataset_id : parent dataset id</span>
<span class="sd">       * components : list of components, only if these are available in AMDA</span>

<span class="sd">    :param id: parameter identification</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :param name: name of the parameter</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param units: units</span>
<span class="sd">    :type units: str</span>
<span class="sd">    :param description: parameter description</span>
<span class="sd">    :type description: str</span>
<span class="sd">    :param displaytype: parameter display type</span>
<span class="sd">    :type displaytype: str</span>
<span class="sd">    :param dataset_id: identification of the parent dataset</span>
<span class="sd">    :type dataset_id: str</span>
<span class="sd">    :param components: list of components </span>
<span class="sd">    :type components: list of amdapy.amda.Collection._Component objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">displaytype</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="p">[]):</span>
      <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">units</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="n">description</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">displaytype</span><span class="o">=</span><span class="n">displaytype</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset_id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">=</span><span class="n">components</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Parameter string representation</span>

<span class="sd">      :return: string representation of the current object</span>
<span class="sd">      :rtype: str</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;Parameter item (id:</span><span class="si">{}</span><span class="s2">, name:</span><span class="si">{}</span><span class="s2">, units:</span><span class="si">{}</span><span class="s2">, disp:</span><span class="si">{}</span><span class="s2">, dataset:</span><span class="si">{}</span><span class="s2">, n:</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displaytype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span></div>

<div class="viewcode-block" id="Collection.Dataset"><a class="viewcode-back" href="../../amdapy.html#amdapy.amda.Collection.Dataset">[docs]</a>  <span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">_CollectionItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This object contains a description of a dataset. Attributes are:</span>
<span class="sd">       * id : unique identifier for the dataset</span>
<span class="sd">       * name : name of the dataset in AMDAs navigation tree</span>
<span class="sd">       * globalstart: data start time (:class:`datetime.datetime` )</span>
<span class="sd">       * globalstop: data stop time (:class:`datetime.datetime`)</span>
<span class="sd">       * parameters : list of parameter descriptions (:class:`amdapy.amda.Collection.Parameter`)</span>
<span class="sd">       * n : number of parameters</span>

<span class="sd">    :param id: dataset identification, should be unique, used for retriving contents of the dataset</span>
<span class="sd">    :type id: str</span>
<span class="sd">    :param name: name of the dataset</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param parameters: list of parameter objects belonging to the dataset</span>
<span class="sd">    :type parameters: list of :class:`amdapy.amda.Collection.Parameter` objects</span>
<span class="sd">    :param globalstart: start time</span>
<span class="sd">    :type globalstart: datetime.datetime</span>
<span class="sd">    :param globalstop: stop time</span>
<span class="sd">    :type globalstop: datetime.datetime</span>

<span class="sd">    This object contains the descriptions of a dataset available in AMDA. You can acces the datasets</span>
<span class="sd">    unique identifier through the :data:`id` attribute that is common to all items of the collection.</span>
<span class="sd">    Datasets are then defined by a :data:`name`, a :data:`description` string, a list of </span>
<span class="sd">    :data:`parameters` (parameter description objects of type :class:`amdapy.amda.Collection.Parameter`.</span>

<span class="sd">    Here is an example of a dataset description string ::</span>

<span class="sd">      Dataset (id:tao-ura-sw, start:2010-01-01 00:00:00, stop:2021-02-19 00:00:00, n_param:7)</span>
<span class="sd">         Parameter (id:ura_sw_n, name:density, units:cm⁻³, shape: (24,))</span>
<span class="sd">         Parameter (id:ura_sw_v, name:velocity, units:km/s, nodata)</span>
<span class="sd">         Parameter (id:ura_sw_t, name:temperature, units:eV, shape: (24,))</span>
<span class="sd">         Parameter (id:ura_sw_pdyn, name:dynamic pressure, units:nPa, shape: (24,))</span>
<span class="sd">         Parameter (id:ura_sw_b, name:b tangential, units:nT, shape: (24,))</span>
<span class="sd">         Parameter (id:ura_sw_bx, name:b radial, units:nT, shape: (24,))</span>
<span class="sd">         Parameter (id:ura_sw_da, name:angle Uranus-Sun-Earth, units:deg, shape: (24,))</span>
<span class="sd">    </span>
<span class="sd">    This object is intended to provide a description of the dataset containing parameter identifiers,</span>
<span class="sd">    name, units and other important information. Downloading the dataset is done by passing a </span>
<span class="sd">    :class:`amdapy.amda.Collection.Dataset` object to the :meth:`amdapy.amda.AMDA.get_dataset` methode.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[],</span> <span class="n">globalstart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globalstop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Object constructor</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">globalstart</span><span class="o">=</span><span class="n">globalstart</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">globalstop</span><span class="o">=</span><span class="n">globalstop</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Dataset string representation</span>
<span class="sd">      </span>
<span class="sd">      :return: Dataset string representation</span>
<span class="sd">      :rtype: str</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">a</span><span class="o">=</span><span class="s2">&quot;Dataset item (id:</span><span class="si">{}</span><span class="s2">, name:</span><span class="si">{}</span><span class="s2">, global_start:</span><span class="si">{}</span><span class="s2">, global_stop:</span><span class="si">{}</span><span class="s2">, n_param:</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">globalstart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">globalstop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">a</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">a</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing Collection&quot;</span><span class="p">)</span>
  <span class="c1"># create the AMDA connector object</span>
  <span class="n">amda</span><span class="o">=</span><span class="n">AMDA</span><span class="p">()</span>
  <span class="n">var</span><span class="o">=</span><span class="n">amda</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ura_sw_da&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">amda</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">))</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting a dataset&quot;</span><span class="p">)</span>
  <span class="n">dataset_id</span><span class="o">=</span><span class="s2">&quot;tao-ura-sw&quot;</span>
  <span class="n">dataset_desc</span> <span class="o">=</span> <span class="n">amda</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">dataset_id</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">amda</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dataset_desc</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting dataset parameter ids&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iter_parameter</span><span class="p">()])</span>

  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bracket operator on dataset&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ura_sw_n&quot;</span><span class="p">])</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ura_sw_n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">amdapy 1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Alexandre Schulz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>